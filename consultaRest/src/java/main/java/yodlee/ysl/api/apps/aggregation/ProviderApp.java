/* * Copyright (c) 2015 Yodlee, Inc. All Rights Reserved. * * This software is the confidential and proprietary information of Yodlee, Inc. * Use is subject to license terms. */package yodlee.ysl.api.apps.aggregation;import java.io.IOException;import java.net.URISyntaxException;import java.util.HashMap;import java.util.List;import java.util.Map;import yodlee.ysl.api.apps.yaas.LoginApp;import yodlee.ysl.api.beans.Provider;import yodlee.ysl.api.beans.Providers;import yodlee.ysl.api.io.HTTP;import yodlee.ysl.api.parsers.GSONParser;import yodlee.ysl.api.util.Console;import yodlee.ysl.api.beans.CobrandContext;import yodlee.ysl.api.beans.Transactions;import yodlee.ysl.api.apps.aggregation.AddProviderAccount;import yodlee.ysl.api.apps.aggregation.ProviderApp;import yodlee.ysl.api.apps.pfm.AccountApp;import yodlee.ysl.api.apps.pfm.HoldingApp;import yodlee.ysl.api.apps.pfm.HoldingSummaryApp;import yodlee.ysl.api.apps.pfm.InvestmentPlanApp;import yodlee.ysl.api.apps.pfm.TransactionApp;import yodlee.ysl.api.apps.pfm.UserRegistrationApp;import yodlee.ysl.api.beans.CobrandContext;import yodlee.ysl.api.beans.UserContext;import yodlee.ysl.api.beans.UserRegistrationResponse;import yodlee.ysl.api.io.HTTP;import yodlee.ysl.api.parsers.GSONParser;import yodlee.ysl.api.util.Console;public class ProviderApp {        private static final String fqcn = ProviderApp.class.getName();    public static Map<String, String> loginTokens = new HashMap<String, String>();    public static Map<String, String> cobTokens = new HashMap<String, String>();    public static final String localURLVer1 = "https://developer.api.yodlee.com/ysl/restserver/v1/";//resourceBundle.getString("yodlee.localURLVer1");    static String coBrandUserName = "sbCobtomas.moreno"; //resourceBundle.getString("yodlee.coBrandUserName");    static String coBrandPassword = "bb8cbff9-9545-465f-b367-4fe4cff6c030";//resourceBundle.getString("yodlee.coBrandPassword");    static String userName = "sbMemtomas.moreno1";//resourceBundle.getString("yodlee.userName");    static String userPassword = "sbMemtomas.moreno1#123";//resourceBundle.getString("yodlee.userPassword");    static String registerParam = "{\"user\": {\"loginName\": \"yslResr976\", \"password\": \"TEST@123\", \"email\": \"yslRest69@yodlee.com\", \"name\": {\"first\": \"FNAME\",\"last\": \"LNAME\" },\"address\": {\"address1\": \"200 Lincoln Ave\",\"state\": \"CA\",\"city\": \"Salinas\",\"zip\": \"93901\",\"country\": \"USA\"},\"preferences\": {\"currency\": \"USD\",\"timeZone\": \"PST\",\"dateFormat\": \"MM/dd/yyyy\"}}}";//resourceBundle.getString("yodlee.registerParam");         	public static String buscarBancos(String searchString) throws IOException,			URISyntaxException {            System.out.println("==============================================================================");                            doCoBrandLogin(coBrandUserName,coBrandPassword);                doMemberLogin(userName,userPassword);		String mn = "searchSite(searchString " + searchString + " )";		System.out.println(fqcn + " :: " + mn);		String searchProviderURL = localURLVer1 + "providers?name="				+ searchString;                System.out.println("searchProviderURL_" + searchProviderURL);		String jsonResponse = HTTP.doGet(searchProviderURL, loginTokens);		Providers providers = (Providers) GSONParser.handleJson(				jsonResponse, yodlee.ysl.api.beans.Providers.class);		if(providers != null){			System.out.println(providers.toString());		}else{			System.out.println("Empty Response..");		}           System.out.println("==============================================================================");           System.out.println("original_"+jsonResponse);           System.out.println("tratado_"+providers.toString());           return  jsonResponse;//providers.toString();	}        	public static boolean getUsuario(String user, String passwd) throws IOException,			URISyntaxException {            System.out.println("==============================================================================");                System.out.println( " ==== Entrada : " + user + " - " + passwd);                doCoBrandLogin(coBrandUserName,coBrandPassword);                boolean respuesta=doMemberLoginPasswd(user,passwd);//(user,passwd);		String mn = "searchSite(searchString " + loginTokens + " )";                System.out.println( "RESPUESTA: " + respuesta);           System.out.println("==============================================================================");           return  respuesta;//providers.toString();	}            public static Transactions getTransactions() throws IOException, URISyntaxException {                String mn = "getTransactions()";                System.out.println(fqcn + " :: " + mn);                 doCoBrandLogin(coBrandUserName,coBrandPassword);                doMemberLogin(userName,userPassword);                String transactionsURL = localURLVer1 + "transactions";                System.out.println("************************** " + transactionsURL);                String jsonResponse = HTTP.doGet(transactionsURL,loginTokens);                System.out.println("lara-" + transactionsURL + "--" + jsonResponse);                Transactions transactions = (Transactions) GSONParser.handleJson(jsonResponse, yodlee.ysl.api.beans.Transactions.class);                if (transactions.getTransaction() != null) {                    System.out.println(transactions.toString() + " ** " + transactionsURL);                } else {                    System.out.println("empty respon");                    transactions=null;                }                return transactions;//jsonResponse;            }                                                                 	public static void searchProvider(String searchString) throws IOException,			URISyntaxException {            System.out.println("==============================================================================");                            doCoBrandLogin(coBrandUserName,coBrandPassword);                doMemberLogin(userName,userPassword);		String mn = "searchSite(searchString " + searchString + " )";		System.out.println(fqcn + " :: " + mn);		String searchProviderURL = localURLVer1 + "providers?name="				+ searchString;                System.out.println("searchProviderURL_" + searchProviderURL);		String jsonResponse = HTTP.doGet(searchProviderURL, loginTokens);		Providers providers = (Providers) GSONParser.handleJson(				jsonResponse, yodlee.ysl.api.beans.Providers.class);		if(providers != null){			System.out.println(providers.toString());		}else{			System.out.println("Empty Response..");		}           System.out.println("==============================================================================");			}	public static Providers getProviderLoginForm(String providerId) throws IOException,			URISyntaxException {		String mn = "getProviderLoginForm(providerId " + providerId + " )";		System.out.println(fqcn + " :: " + mn);		String getSiteURL = localURLVer1 + "providers/" + providerId;		String jsonResponse = HTTP.doGet(getSiteURL, loginTokens);		Providers providers = (Providers) GSONParser.handleJson(				jsonResponse, yodlee.ysl.api.beans.Providers.class);		System.out.println(providers.toString());		return providers;	}                	public static void doCoBrandLogin(String coBrandUserName, String coBrandPassword) throws IOException {		String mn = "doCoBrandLogin(coBrandUserName " + coBrandUserName + ", coBrandPassword " + coBrandPassword + " )";		System.out.println(fqcn + " :: " + mn);		System.out.println("localURLVer1: " + localURLVer1);		final String requestBody="cobrandLogin="+coBrandUserName+"&cobrandPassword="+coBrandPassword;		String coBrandLoginURL = localURLVer1 + "cobrand/login";		//HTTP.createConnection(coBrandLoginURL);		String jsonResponse = HTTP.doPost(coBrandLoginURL, requestBody);		System.out.println("jsonResponse: " + jsonResponse);		CobrandContext coBrand = (CobrandContext) GSONParser.handleJson(jsonResponse, yodlee.ysl.api.beans.CobrandContext.class);		// Change the toString() method of the class to decide what to display on the Console.		System.out.println(coBrand.toString());		cobTokens.put("cobSession", coBrand.getSession().getCobSession());		loginTokens.put("cobSession", coBrand.getSession().getCobSession());	}		public static void doMemberLogin(String userName, String userPassword) throws IOException {		String mn = "doMemberLogin(userLogin=" +userName+ ", userPassword = " + userPassword + ", coBrandSessionCredential =" + loginTokens.get("cobSession") + " )";		System.out.println("aqui----------> " + fqcn + " :: " + mn);		final String requestBody="coBrandSessionCredential="+ loginTokens.get("cobSession")+"&loginName=" +  userName + "&password="+ userPassword;		String userLoginURL = localURLVer1 + "user/login";                System.out.println("URL----------> " + userLoginURL);                System.out.println("TOKEN----------> " + loginTokens);                System.out.println("BODY----------> " + requestBody);		//HTTP.addHeaders("Authorization" , loginTokens.get("cobSession"));		String jsonResponse = HTTP.doPostUser(userLoginURL,loginTokens, requestBody,true);                                System.out.println( "****** " + jsonResponse);		UserContext member = (UserContext) GSONParser.handleJson(jsonResponse, yodlee.ysl.api.beans.UserContext.class);		// Change the toString() method of the class to decide what to display on the Console.		System.out.println(member.toString());		loginTokens.put("userSession", member.getUser().getSession().getUserSession());	}                        	        public static boolean doMemberLoginPasswd(String userName, String userPassword) throws IOException {		String mn = "doMemberLogin(userLogin=" +userName+ ", userPassword = " + userPassword + ", coBrandSessionCredential =" + loginTokens.get("cobSession") + " )";		System.out.println("aqui----------> " + fqcn + " :: " + mn);		final String requestBody="coBrandSessionCredential="+ loginTokens.get("cobSession")+"&loginName=" + userName + "&password="+ userPassword;		String userLoginURL = localURLVer1 + "user/login";                System.out.println("URL----------> " + userLoginURL);                System.out.println("TOKEN----------> " + loginTokens);                System.out.println("BODY----------> " + requestBody);		//HTTP.addHeaders("Authorization" , loginTokens.get("cobSession"));		boolean jsonResponse = HTTP.doPostUserPasswd(userLoginURL,loginTokens, requestBody,true);                return jsonResponse;	}                        		public static void doLogin(String coBrandUserName, String coBrandPassword,String userName, String userPassword) throws IOException	{		doCoBrandLogin(coBrandUserName,coBrandPassword);		doMemberLogin(userName,userPassword);	}	                }